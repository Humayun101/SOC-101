
Registry entries can help in persistence stage of attack, so its important to identify abnormal settings and configurations
- Sceduled task
- Adding instance of code in registry so it can start with bootup
	- Adding a key to .exe and defining its path to registry under the - **HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run** can help adversery to start whenever a user logs in
- Malicious services to start binaries

An example of creating a backdoor for our previous [[02. Creating a Malware For Testing]] reference
- <img src="Pasted image 20251109173953.png">

	Now our reverseshell software will always start whenever a user logs into the system as we have added they registry key for it
These queries can be seen through regedit, cmd and powershell

**Investigative Way to enumerate auto start entries**
- Autorun tool from sysinternal
	- https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns
	- shows us which registry keys start at windows or when specific conditions are met
	- can help us know about various information about entry
- Auto-run powershell module
	- https://github.com/p0w3rsh3ll/AutoRuns
	- powershell script tool(need execution policy to be unrestricted)

*Refer to autorun practical exercises

# Task Scheduler 

Task scheduler is another way of gaining persistence
**Generalize Scenario**

We want to create a task that get activated and send us reverse shell everyday on 9PM, for that we will use
- schtasks(cmd utility)-> schtasks /create /tn "Backup.d" /tr "Location of exe" /sc daily /st 09:00 /ru SYSTEM
	- tn= taskname
	- /tr= task location
	- /sc= scedule circle, can be daily, weekly etc
	- /st= "" time 
	- /ru= run user, mean which user to execute from 

https://www.elastic.co/security-labs/exploring-the-qbot-attack-pattern = case study of how Task scheduler can help in persistance


**Ways to Query Tasks**
- Task Scheduler GUI
- schtasks /query /fo LIST= cli based utility
	- (if name is known): schtasks /query /tn "name" /fo /v LIST
- sysinternal Autorun can also help us in query